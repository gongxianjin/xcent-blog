:::tip  
 要写好C语言，漂亮的宏定义是非常重要的。宏定义可以帮助我们防止出错，提高代码的可移植性和可读性等。

在软件开发过程中，经常有一些常用或者通用的功能或者代码段，这些功能既可以写成函数，也可以封装成为宏定义。那么究竟是用函数好，还是宏定义好？这就要求我们对二者进行合理的取舍。
::: 


还有一些任务根本无法用函数实现，但是用宏定义却很好实现。比如参数类型没法作为参数传递给函数，但是可以把参数类型传递给带参的宏。

 

看下面的例子：

 
```
#define MALLOC（n, type） /

                                （ (type *) malloc（（n）* sizeof（type）））
```
 

利用这个宏，我们就可以为任何类型分配一段我们指定的空间大小，并返回指向这段空间的指针。我们可以观察一下这个宏确切的工作过程：

 
```
int *ptr;

        ptr = MALLOC ( 5, int );
```
 

将这宏展开以后的结果：

 
```
ptr = (int *) malloc ( (5) * sizeof(int) );
```
 

这个例子是宏定义的经典应用之一，完成了函数不能完成的功能，但是宏定义也不能滥用，通常，如果相同的代码需要出现在程序的几个地方，更好的方法是把它实现为一个函数。

 


下面总结和宏和函数的不同之处，以供大家写代码时使用，这段总结摘自《C和指针》一书。

 

### 代码长度

 #define宏：每次使用时，宏代码都被插入到程序中。除了非常小的宏之外，程序的长度将大幅度增长

  函数：函数代码只出现于一个地方：每次使用这个函数时，都调用那个地方的同一份代码

 

### 执行速度

 #define宏：更快

 函数： 存在函数调用、返回的额外开销

 

###  操作符优先级

 #define宏：宏参数的求值是在所有周围表达式的上下文环境里，除非它们加上括号，否则邻近操作符的优先级可能产生不可预料的结果。

 函数：函数参数只在函数调用时求值一次，它的结果值传递给函数。表达式的求值结果更容易预测。

 

### 参数求值

 #define宏：参数用于宏定义时，每次都将重新求值，由于多次求值，具有副作用的参数可能会产生不可预测的结果。

  函数：参数在函数调用前只求值一次，在函数中多次使用参数并不会导致多次求值过程，参数的副作用并不会造成任何特殊问题。

 

### 参数类型

 #define宏：宏与类型无关，只要参数的操作是合法的，它可以用于任何参数类型。

  函数： 函数的参数是与类型有关系的，如果参数的类型不同，就需要使用不同的函数，即使它们执行的任务是相同的。

 